<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SafeTour - Perfil</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="safetour.png">
</head>
<body>
    <div class="container">
        <header>
            <a id="back-button" href="#">Voltar</a>
        </header>

        <div class="page-header">
            <img src="safetour-logo.png" alt="SafeTour Logo" class="logo">
            <h2>Perfil do Usuário</h2>
        </div>

        <section id="perfil-info">
            <div id="loading" style="text-align: center;">Carregando perfil...</div>
            <div id="perfil-data"></div>
            <div id="error-message" style="color: red; text-align: center;"></div>
        </section>
    </div>

    <script src="https://unpkg.com/jwt-decode@3.1.2/build/jwt-decode.js"></script>
    <script>
        const API_BASE_URL = 'https://safetour-backend.onrender.com';
        const perfilData = document.getElementById('perfil-data');
        const errorMessage = document.getElementById('error-message');
        const loadingMessage = document.getElementById('loading');

        // Lógica de redirecionamento do botão Voltar
        const token = localStorage.getItem('authToken');
        if (token) {
            const decodedToken = jwt_decode(token);
            const userType = decodedToken.userType;
            if (userType === 'turista') {
                document.getElementById('back-button').href = 'dashboard-turista.html';
            } else if (userType === 'agencia' || userType === 'guia') {
                document.getElementById('back-button').href = 'dashboard-agencia-guia.html';
            }
        }
        
        async function fetchUserProfile() {
            const token = localStorage.getItem('authToken');
            if (!token) {
                loadingMessage.style.display = 'none';
                errorMessage.textContent = 'Você não está logado. Redirecionando para o login...';
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/auth/perfil`, {
                    method: 'GET',
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const user = await response.json();
                loadingMessage.style.display = 'none';

                if (response.ok) {
                    perfilData.innerHTML = `
                        <p><b>Nome:</b> ${user.nome}</p>
                        <p><b>Email:</b> ${user.email}</p>
                        <p><b>Tipo de Conta:</b> ${user.tipo}</p>
                    `;
                } else {
                    errorMessage.textContent = user.erro || 'Falha ao carregar perfil.';
                }
            } catch (err) {
                loadingMessage.style.display = 'none';
                errorMessage.textContent = `Erro de conexão: ${err.message}`;
            }
        }

        window.onload = fetchUserProfile;
    </script>
</body>
</html>